var e=s(require("query-string")),t=s(require("lru-cache")),r=s(require("axios")),n=require("react"),o=s(n),u=n.Component,c=n.Suspense,a=n.useEffect,i=n.useState;function s(e){return e&&e.__esModule?e.default:e}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f=new t({max:100,maxAge:6e5}),p={},y=function(e,t,r,n){t?p[t].splice(0,p[t].length).forEach((function(e){var t=e.resolve,o=e.reject;n?o(n):t({data:null==r?void 0:r.data,response:r})})):n?e.reject(n):e.resolve({data:null==r?void 0:r.data,response:r})},b=function(e){return e?"object"!==l(e)?e:Object.keys(e).reduce((function(t,r){return"object"===l(e[r])?e[r].current instanceof HTMLElement?t[r]=e[r].current.value:t[r]=b(e[r]):t[r]=e[r],t}),{}):e};function d(t){return new Promise((function(n,o){setTimeout((function(){var u,c,a,i=(u=t.url,c=t.query||{},a=e.stringify(c),u+(a?(u.includes("?")?"&":"?")+a:"")),s="GET"===t.method&&t.cacheMaxAge&&t.cacheMaxAge>0?"":null,l=s&&f.get(s),d="GET"===t.method&&t.throttle?"".concat(t.method," ").concat(i," ").concat(t.delay||0):null;if(!(d&&(p[d]=p[d]||[],p[d].push({resolve:n,reject:o}),p[d].length>1)))if(l)n(l);else{var h=(new Date).getTime();r.request({method:t.method,url:i,headers:t.headers,responseType:t.responseType,data:b("function"==typeof t.data?t.data():t.data)}).then((function(e){var r=(t.delay||0)-((new Date).getTime()-h);setTimeout((function(){y({resolve:n,reject:o},d,e,null)}),Math.max(0,r))})).catch((function(e){var r=(t.delay||0)-((new Date).getTime()-h);setTimeout((function(){y({resolve:n,reject:o},d,null,e)}),Math.max(0,r))}))}}),25)}))}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=E(e);if(t){var o=E(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return w(this,r)}}function w(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(a,u);var t,r,n,c=S(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=c.call(this,e)).state={busy:!1},t}return t=a,(r=[{key:"handleClick",value:function(){var e=this;this.state.busy||(this.setState(v(v({},this.state),{},{busy:!0})),d(v({},this.props.api)).then((function(t){e.props.success&&e.props.success(t.data,t.response),e.props.done&&e.props.done(t.data,null,t.response),e.setState(v(v({},e.state),{},{busy:!1}))})).catch((function(t){e.props.error&&e.props.error(t),e.props.done&&e.props.done(null,t,null),e.setState(v(v({},e.state),{},{busy:!1}))})))}},{key:"render",value:function(){var e=this;return o.createElement("button",{className:"flax fx-button",onClick:function(){return e.handleClick()},disabled:this.state.busy},this.props.children||this.props.label)}}])&&O(t.prototype,r),n&&O(t,n),a}();function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return"string"==typeof t&&t?e.push(t):Array.isArray(t)?e.push(k(t)):t&&"object"===x(t)&&Object.keys(t).forEach((function(r){t[r]&&e.push(r)})),e}),[]).join(" ")}function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){D(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=N(e);if(t){var o=N(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return C(this,r)}}function C(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,u=void 0;try{for(var c,a=e[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,u=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw u}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return B(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function M(e,t){return function(){return{status:t?"ERROR":"SUCCESS",result:(null==e?void 0:e.data)||null,error:t}}}exports.FxButton=P;function G(e){var t=q(i(),2),r=t[0],n=t[1],u=e.api,c=e.refreshId,s=e.reloadId,l=e.error,f=e.naked,p=function(){return d(Object.assign({throttle:!1!==u.throttle,refreshId:c},e.api))};if(a((function(){s>0&&p().then((function(t){n((function(){return M(t,null)})),e.releaseBusy(!0)})).catch((function(t){n((function(){return M(null,t)})),e.releaseBusy(!1)}))}),[s]),a((function(){n((function(){return function(e,t){var r,n,o="PENDING";return t.then((function(t){var u=M(t,null)();n=u.result,o=u.status,r=u.error,e(!0)})).catch((function(t){var u=M(null,t)();n=u.result,o=u.status,r=u.error,e(!1)})),function(){if("PENDING"===o)throw t;return{status:o,error:r,result:n}}}(e.releaseBusy,p())}))}),[u.method,u.url,c]),!r)return o.createElement(o.Fragment,null);var y,b,h=r();if("ERROR"===h.status){return o.createElement(o.Fragment,null,f&&o.createElement(o.Fragment,null,l&&l((null===(y=h.error)||void 0===y||null===(b=y.response)||void 0===b?void 0:b.data)||null,h.error),!l&&o.createElement("div",null,"Error (",h.error.message,")")),!f&&o.createElement("div",{className:"flax fx-guard-error"},"r()"))}return o.createElement(o.Fragment,null,e.render(h.result))}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(i,u);var t,r,n,a=F(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=a.call(this,e)).state={refreshId:0,reloadId:0,busy:!1},t}return t=i,(r=[{key:"reload",value:function(e){this.state.busy||(e?this.setState(_(_({},this.state),{},{reloadId:this.state.reloadId+1,busy:!0})):this.setState(_(_({},this.state),{},{refreshId:this.state.refreshId+1,busy:!0})))}},{key:"releaseBusy",value:function(e){this.props.done&&this.props.done(e),this.setState(_(_({},this.state),{},{busy:!1}))}},{key:"render",value:function(){var e=this,t=function(){var t=function(){return o.createElement(o.Fragment,null,e.props.loading&&e.props.loading(),!e.props.loading&&o.createElement("div",{className:"flax fx-guard-loader"},"Loading .."))};return o.createElement(o.Fragment,null,o.createElement(c,{fallback:o.createElement(o.Fragment,null,e.props.naked&&t(),!e.props.naked&&o.createElement("div",{className:"flax fx-guard-loading"},t()))},o.createElement(G,{releaseBusy:function(t){return e.releaseBusy(t)},refreshId:e.state.refreshId,reloadId:e.state.reloadId,api:e.props.api,render:e.props.render,error:e.props.error,naked:e.props.naked})))};return o.createElement(o.Fragment,null,this.props.naked&&t(),!this.props.naked&&o.createElement("div",{className:k("flax fx-guard",{"--loading":this.state.busy})},t()))}}])&&T(t.prototype,r),n&&T(t,n),i}();exports.FxGuard=L;
//# sourceMappingURL=index.js.map
