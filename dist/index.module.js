import e from"query-string";import t from"lru-cache";import r from"axios";import s,{Component as n,Suspense as o,useEffect as a,useState as l}from"react";const c=new t({max:100,maxAge:6e5}),i={},u=(e,t,r,s)=>{if(!t)return void(s?e.reject(s):e.resolve({data:null==r?void 0:r.data,response:r}));i[t].splice(0,i[t].length).forEach((({resolve:e,reject:t})=>{s?t(s):e({data:null==r?void 0:r.data,response:r})}))},p=e=>e?"object"!=typeof e?e:Object.keys(e).reduce(((t,r)=>("object"==typeof e[r]?e[r].current instanceof HTMLElement?t[r]=e[r].current.value:t[r]=p(e[r]):t[r]=e[r],t)),{}):e;function h(t){return new Promise(((s,n)=>{setTimeout((()=>{const o=((t,r)=>{const s=e.stringify(r);return t+(s?(t.includes("?")?"&":"?")+s:"")})(t.url,t.query||{}),a="GET"===t.method&&t.cacheMaxAge&&t.cacheMaxAge>0?"":null,l=a&&c.get(a),h="GET"===t.method&&t.throttle?"".concat(t.method," ").concat(o):null;if(h&&(i[h]=i[h]||[],i[h].push({resolve:s,reject:n}),i[h].length>1))return;if(l)return void s(l);const d=(new Date).getTime();r.request({method:t.method,url:o,headers:t.headers,responseType:t.responseType,data:p("function"==typeof t.data?t.data():t.data)}).then((e=>{const r=(t.delay||0)-((new Date).getTime()-d);setTimeout((()=>{u({resolve:s,reject:n},h,e,null)}),Math.max(0,r))})).catch((e=>{u({resolve:s,reject:n},h,null,e)}))}),25)}))}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}export class FxButton extends n{constructor(e){super(e),this.state={busy:!1}}handleClick(){this.state.busy||(this.setState(f(f({},this.state),{},{busy:!0})),h(f({},this.props.api)).then((e=>{this.props.success&&this.props.success(e.data,e.response),this.props.done&&this.props.done(e.data,null,e.response),this.setState(f(f({},this.state),{},{busy:!1}))})).catch((e=>{this.props.error&&this.props.error(e),this.props.done&&this.props.done(null,e,null),this.setState(f(f({},this.state),{},{busy:!1}))})))}render(){return s.createElement("button",{className:"fx-button",onClick:()=>this.handleClick(),disabled:this.state.busy},this.props.children||this.props.label)}}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t){return()=>({status:t?"ERROR":"SUCCESS",result:(null==e?void 0:e.data)||null,error:t})}function j(e){const[t,r]=l(),{api:n,refreshId:o,reloadId:c}=e,i=()=>h(Object.assign({throttle:!1!==n.throttle,refreshId:o},e.api));if(a((()=>{c>0&&i().then((t=>{r((()=>g(t,null))),e.releaseBusy(!0)})).catch((t=>{r((()=>g(null,t))),e.releaseBusy(!1)}))}),[c]),a((()=>{r((()=>function(e,t){let r,s,n="PENDING";return t.then((t=>{({result:s,status:n,error:r}=g(t,null)()),e(!0)})).catch((t=>{({result:s,status:n,error:r}=g(null,t)()),e(!1)})),()=>{if("PENDING"===n)throw t;return{status:n,error:r,result:s}}}(e.releaseBusy,i())))}),[n.method,n.url,o]),!t)return s.createElement(s.Fragment,null);const u=t();return"ERROR"===u.status?s.createElement(s.Fragment,null,s.createElement("div",null,"Error (",u.error.message,")")):s.createElement(s.Fragment,null,e.render(u.result))}export class FxGuard extends n{constructor(e){super(e),this.state={refreshId:0,reloadId:0,busy:!1}}reload(e){this.state.busy||(e?this.setState(m(m({},this.state),{},{reloadId:this.state.reloadId+1,busy:!0})):this.setState(m(m({},this.state),{},{refreshId:this.state.refreshId+1,busy:!0})))}releaseBusy(e){this.props.done&&this.props.done(e),this.setState(m(m({},this.state),{},{busy:!1}))}render(){return s.createElement("div",{className:"fx-guard"},s.createElement(o,{fallback:s.createElement("div",{className:"fx-guard-loader"},"Loading ..")},s.createElement(j,{releaseBusy:e=>this.releaseBusy(e),refreshId:this.state.refreshId,reloadId:this.state.reloadId,api:this.props.api,render:this.props.render})))}}
//# sourceMappingURL=index.module.js.map
