import e from"query-string";import t from"lru-cache";import r from"axios";import s,{Component as n,Suspense as o,useEffect as a,useState as l}from"react";const i=new t({max:100,maxAge:6e5}),u={},c=(e,t,r,s)=>{if(!t)return void(s?e.reject(s):e.resolve({data:null==r?void 0:r.data,response:r}));u[t].splice(0,u[t].length).forEach((({resolve:e,reject:t})=>{s?t(s):e({data:null==r?void 0:r.data,response:r})}))};function h(t){return new Promise(((s,n)=>{setTimeout((()=>{const o=((t,r)=>{const s=e.stringify(r);return t+(s?(t.includes("?")?"&":"?")+s:"")})(t.url,t.query||{}),a="GET"===t.method&&t.cacheMaxAge&&t.cacheMaxAge>0?"":null,l=a&&i.get(a),h="GET"===t.method&&t.throttle?"".concat(t.method," ").concat(o):null;h&&(u[h]=u[h]||[],u[h].push({resolve:s,reject:n}),u[h].length>1)||(l?s(l):setTimeout((()=>{r.request({method:t.method,url:o}).then((e=>{c({resolve:s,reject:n},h,e,null)})).catch((e=>{c({resolve:s,reject:n},h,null,e)}))}),25))}),t.delay||0)}))}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}export class FxButton extends n{constructor(e){super(e),this.state={busy:!1}}handleClick(){this.state.busy||(this.setState(d(d({},this.state),{},{busy:!0})),h(d({},this.props.api)).then((e=>{this.props.success&&this.props.success(e.data,e.response),this.props.done&&this.props.done(e.data,null,e.response),this.setState(d(d({},this.state),{},{busy:!1}))})).catch((e=>{this.props.error&&this.props.error(e),this.props.done&&this.props.done(null,e,null),this.setState(d(d({},this.state),{},{busy:!1}))})))}render(){return s.createElement("button",{className:"fx-button",onClick:()=>this.handleClick(),disabled:this.state.busy},this.props.children||this.props.label)}}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t){return()=>({status:t?"ERROR":"SUCCESS",result:(null==e?void 0:e.data)||null,error:t})}function g(e){const[t,r]=l(),{api:n,refreshId:o,reloadId:i}=e,u=()=>h(Object.assign({throttle:!1!==n.throttle,refreshId:o},e.api));if(a((()=>{i>0&&u().then((t=>{r((()=>O(t,null))),e.releaseBusy(!0)})).catch((t=>{r((()=>O(null,t))),e.releaseBusy(!1)}))}),[i]),a((()=>{r((()=>function(e,t){let r,s,n="PENDING";return t.then((t=>{({result:s,status:n,error:r}=O(t,null)()),e(!0)})).catch((t=>{({result:s,status:n,error:r}=O(null,t)()),e(!1)})),()=>{if("PENDING"===n)throw t;return{status:n,error:r,result:s}}}(e.releaseBusy,u())))}),[n.method,n.url,o]),!t)return s.createElement(s.Fragment,null);const c=t();return"ERROR"===c.status?s.createElement(s.Fragment,null,s.createElement("div",null,"Error (",c.error.message,")")):s.createElement(s.Fragment,null,e.render(c.result))}export class FxGuard extends n{constructor(e){super(e),this.state={refreshId:0,reloadId:0,busy:!1}}reload(e){this.state.busy||(e?this.setState(y(y({},this.state),{},{reloadId:this.state.reloadId+1,busy:!0})):this.setState(y(y({},this.state),{},{refreshId:this.state.refreshId+1,busy:!0})))}releaseBusy(e){this.props.done&&this.props.done(e),this.setState(y(y({},this.state),{},{busy:!1}))}render(){return s.createElement("div",{className:"fx-guard"},s.createElement(o,{fallback:s.createElement("div",{className:"fx-guard-loader"},"Loading ..")},s.createElement(g,{releaseBusy:e=>this.releaseBusy(e),refreshId:this.state.refreshId,reloadId:this.state.reloadId,api:this.props.api,render:this.props.render})))}}
//# sourceMappingURL=index.module.js.map
