import e from"query-string";import t from"lru-cache";import r from"axios";import s,{Component as n,Suspense as a,useEffect as o,useState as l}from"react";export function FxButton(e){return s.createElement(s.Fragment,null,"FxButton")}const u=new t({max:100,maxAge:6e5}),c={},i=(e,t,r,s)=>{if(!t)return void(s?e.reject(s):e.resolve({data:null==r?void 0:r.data,response:r}));c[t].splice(0,c[t].length).forEach((({resolve:e,reject:t})=>{s?t(s):e({data:null==r?void 0:r.data,response:r})}))};function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){return()=>({status:t?"ERROR":"SUCCESS",result:(null==e?void 0:e.data)||null,error:t})}function p(t){const[n,a]=l(),{api:d,refreshId:h,reloadId:f}=t,p=()=>function(t){return new Promise(((s,n)=>{setTimeout((()=>{const a=((t,r)=>{const s=e.stringify(r);return t+(s?(t.includes("?")?"&":"?")+s:"")})(t.url,t.query||{}),o="GET"===t.method&&t.cacheMaxAge&&t.cacheMaxAge>0?"":null,l=o&&u.get(o),d="GET"===t.method&&t.throttle?"".concat(t.method," ").concat(a):null;d&&(c[d]=c[d]||[],c[d].push({resolve:s,reject:n}),c[d].length>1)||(l?s(l):setTimeout((()=>{r.request({method:t.method,url:a}).then((e=>{i({resolve:s,reject:n},d,e,null)})).catch((e=>{i({resolve:s,reject:n},d,null,e)}))}),25))}),t.delay||0)}))}(Object.assign({throttle:!1!==d.throttle,refreshId:h},t.api));if(o((()=>{f>0&&p().then((e=>{a((()=>m(e,null))),t.releaseBusy(!0)})).catch((e=>{a((()=>m(null,e))),t.releaseBusy(!1)}))}),[f]),o((()=>{a((()=>function(e,t){let r,s,n="PENDING";return t.then((t=>{({result:s,status:n,error:r}=m(t,null)()),e(!0)})).catch((t=>{({result:s,status:n,error:r}=m(null,t)()),e(!1)})),()=>{if("PENDING"===n)throw t;return{status:n,error:r,result:s}}}(t.releaseBusy,p())))}),[d.method,d.url,h]),!n)return s.createElement(s.Fragment,null);const y=n();return"ERROR"===y.status?s.createElement(s.Fragment,null,s.createElement("div",null,"Error (",y.error.message,")")):s.createElement(s.Fragment,null,t.render(y.result))}export class FxGuard extends n{constructor(e){super(e),this.state={refreshId:0,reloadId:0,busy:!1}}reload(e){this.state.busy||(e?this.setState(h(h({},this.state),{},{reloadId:this.state.reloadId+1,busy:!0})):this.setState(h(h({},this.state),{},{refreshId:this.state.refreshId+1,busy:!0})))}releaseBusy(e){this.props.done&&this.props.done(e),this.setState(h(h({},this.state),{},{busy:!1}))}render(){return s.createElement("div",{className:"fx-guard"},s.createElement(a,{fallback:s.createElement("div",{className:"fx-guard-loader"},"Loading ..")},s.createElement(p,{releaseBusy:e=>this.releaseBusy(e),refreshId:this.state.refreshId,reloadId:this.state.reloadId,api:this.props.api,render:this.props.render})))}}
//# sourceMappingURL=index.module.js.map
