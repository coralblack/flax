import e from"query-string";import t from"lru-cache";import r from"axios";import n,{Component as o,Suspense as s,useEffect as a,useState as c}from"react";import"./index.css";export function FxButton(e){return n.createElement(n.Fragment,null,"FxButton")}const u=new t({max:100,maxAge:6e5}),l={},i=(e,t,r,n)=>{if(!t)return void(n?e.reject(n):e.resolve({data:null==r?void 0:r.data,response:r}));l[t].splice(0,l[t].length).forEach((({resolve:e,reject:t})=>{n?t(n):e({data:null==r?void 0:r.data,response:r})}))};function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(t){const[o,s]=c(),{api:m,count:p}=t;if(a((()=>{s((()=>function(e,t){let r,n,o="PENDING";return t.then((t=>{n=t.data,o="SUCCESS",e()})).catch((t=>{r=t,o="ERROR",e()})),()=>{if("PENDING"===o)throw t;return{status:o,error:r,result:n}}}(t.releaseBusy,function(t){return new Promise(((n,o)=>{setTimeout((()=>{const s=((t,r)=>{const n=e.stringify(r);return t+(n?(t.includes("?")?"&":"?")+n:"")})(t.url,t.query||{}),a="GET"===t.method&&t.cacheMaxAge&&t.cacheMaxAge>0?"":null,c=a&&u.get(a),m="GET"===t.method&&t.throttle?"".concat(t.method," ").concat(s):null;m&&(l[m]=l[m]||[],l[m].push({resolve:n,reject:o}),l[m].length>1)||(c?n(c):setTimeout((()=>{r.request({method:t.method,url:s}).then((e=>{i({resolve:n,reject:o},m,e,null)})).catch((e=>{i({resolve:n,reject:o},m,null,e)}))}),25))}),t.delay||0)}))}(Object.assign({throttle:!1!==m.throttle,count:p},t.api)))))}),[m.method,m.url,p]),!o)return n.createElement(n.Fragment,null);const h=o();return"ERROR"===h.status?n.createElement(n.Fragment,null,n.createElement("div",null,"Error (",h.error.message,")")):n.createElement(n.Fragment,null,t.render(h.result))}export class FxGuard extends o{constructor(e){super(e),this.state={count:0,busy:!1}}reload(){this.state.busy||this.setState({count:this.state.count+1,busy:!0})}releaseBusy(){this.setState(p(p({},this.state),{},{busy:!1}))}render(){return n.createElement("div",{className:"fx-guard"},n.createElement(s,{fallback:n.createElement("div",{className:"fx-guard-loader"},"Loading ..")},n.createElement(d,{releaseBusy:()=>this.releaseBusy(),count:this.state.count,api:this.props.api,render:this.props.render})))}}
//# sourceMappingURL=index.module.js.map
