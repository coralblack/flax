import e from"query-string";import t from"lru-cache";import r from"axios";import n,{render as s}from"react-dom";import o,{Component as a,useEffect as i,Suspense as l,useState as c}from"react";function u(...e){return e.reduce(((e,t)=>("string"==typeof t&&t?e.push(t):Array.isArray(t)?e.push(u(t)):t&&"object"==typeof t&&Object.keys(t).forEach((r=>{t[r]&&e.push(r)})),e)),[]).join(" ")}function d(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}function p(e){const{container:t}={container:document.getElementById("fx-notification-container")||(()=>{const e=document.createElement("div");return e.id="fx-notification-container",e.classList.add("flax"),e.classList.add("fx-notification-container"),document.body.appendChild(e),e})()};return{container:t,alert:e=>{const{delay:r}=e,a=d(e,["delay"]),i=document.createElement("div");i.classList.add("fx-notification-wrapper"),t.appendChild(i),s(o.createElement(h,a),i),setTimeout((()=>{i.classList.add("--hide"),setTimeout((()=>{n.unmountComponentAtNode(i),i.remove()}),450)}),r||3e3)}}}function h(e){const{type:t,title:r,message:n}=e;return i((()=>()=>{})),o.createElement(o.Fragment,null,o.createElement("div",{className:u("flax fx-notification","--".concat((t||"info").toLocaleLowerCase()))},t&&function(e){return e&&"INFO"!==e?o.createElement("div",{className:"--icon"},"SUCC"===e&&o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})),"WARN"===e&&o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})),"ERROR"===e&&o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}))):null}(t),r&&o.createElement("strong",null,r),n))}const f=new t({max:100,maxAge:6e5}),m={},y=(e,t,r,n)=>{if(!t)return void(n?e.reject(n):e.resolve({data:null==r?void 0:r.data,response:r}));m[t].splice(0,m[t].length).forEach((({resolve:e,reject:t})=>{n?t(n):e({data:null==r?void 0:r.data,response:r})}))},b=e=>e?"object"!=typeof e?e:Object.keys(e).reduce(((t,r)=>("object"==typeof e[r]?e[r].current instanceof HTMLElement?t[r]=e[r].current.value:t[r]=b(e[r]):t[r]=e[r],t)),{}):e;function g(t){return new Promise(((n,s)=>{setTimeout((()=>{const o=((t,r)=>{const n=e.stringify(r);return t+(n?(t.includes("?")?"&":"?")+n:"")})(t.url,t.query||{}),a="GET"===t.method&&t.cacheMaxAge&&t.cacheMaxAge>0?"":null,i=a&&f.get(a),l="GET"===t.method&&t.throttle?"".concat(t.method," ").concat(o," ").concat(t.delay||0):null;if(l&&(m[l]=m[l]||[],m[l].push({resolve:n,reject:s}),m[l].length>1))return;if(i)return void n(i);const c=(new Date).getTime();r.request({method:t.method,url:o,headers:t.headers,responseType:t.responseType,data:b("function"==typeof t.data?t.data():t.data)}).then((e=>{const r=(t.delay||0)-((new Date).getTime()-c);setTimeout((()=>{y({resolve:n,reject:s},l,e,null)}),Math.max(0,r))})).catch((e=>{const r=(t.delay||0)-((new Date).getTime()-c);setTimeout((()=>{y({resolve:n,reject:s},l,null,e)}),Math.max(0,r))}))}),25)}))}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}export class FxButton extends a{constructor(e){super(e),this.state={busy:!1}}noti(e,t){if(!e)return;"string"==typeof e&&(e={message:e}),e.type=e.type||t;const{alert:r}=p();r(e)}handleClick(){if(this.state.busy)return;this.setState(O(O({},this.state),{},{busy:!0}));const{success:e,error:t,done:r}=this.props;g(O({},this.props.api)).then((t=>{this.noti(e&&e(t.data,t.response),"SUCC"),this.noti(r&&r(t.data,null,t.response),"INFO"),this.setState(O(O({},this.state),{},{busy:!1}))})).catch((e=>{var n,s,o,a;const i="number"==typeof(null===(n=e.response)||void 0===n?void 0:n.status)&&(null===(s=e.response)||void 0===s?void 0:s.status)<500?"WARN":"ERROR";this.noti(t&&t(null===(o=e.response)||void 0===o?void 0:o.data,e),i),this.noti(r&&r(null===(a=e.response)||void 0===a?void 0:a.data,e,e.response),i),this.setState(O(O({},this.state),{},{busy:!1}))}))}render(){return o.createElement("button",{className:"flax fx-button",onClick:()=>this.handleClick(),disabled:this.state.busy},this.props.children||this.props.label)}}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){x(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e,t){return()=>({status:t?"ERROR":"SUCCESS",result:(null==e?void 0:e.data)||null,error:t})}function P(e){const[t,r]=c(),{api:n,refreshId:s,reloadId:a,error:l,naked:u}=e,d=()=>g(Object.assign({throttle:!1!==n.throttle,refreshId:s},e.api));if(i((()=>{a>0&&d().then((t=>{r((()=>k(t,null))),e.releaseBusy(!0)})).catch((t=>{r((()=>k(null,t))),e.releaseBusy(!1)}))}),[a]),i((()=>{r((()=>function(e,t){let r,n,s="PENDING";return t.then((t=>{({result:n,status:s,error:r}=k(t,null)()),e(!0)})).catch((t=>{({result:n,status:s,error:r}=k(null,t)()),e(!1)})),()=>{if("PENDING"===s)throw t;return{status:s,error:r,result:n}}}(e.releaseBusy,d())))}),[n.method,n.url,s]),!t)return o.createElement(o.Fragment,null);const p=t();if("ERROR"===p.status){const e=()=>{var e,t;return o.createElement(o.Fragment,null,l&&l((null===(e=p.error)||void 0===e||null===(t=e.response)||void 0===t?void 0:t.data)||null,p.error),!l&&o.createElement("div",null,"Error (",p.error.message,")"))};return o.createElement(o.Fragment,null,u&&e(),!u&&o.createElement("div",{className:"flax fx-guard-error"},"r()"))}return o.createElement(o.Fragment,null,e.render(p.result))}export class FxGuard extends a{constructor(e){super(e),this.state={refreshId:0,reloadId:0,busy:!1}}reload(e){this.state.busy||(e?this.setState(w(w({},this.state),{},{reloadId:this.state.reloadId+1,busy:!0})):this.setState(w(w({},this.state),{},{refreshId:this.state.refreshId+1,busy:!0})))}releaseBusy(e){this.props.done&&this.props.done(e),this.setState(w(w({},this.state),{},{busy:!1}))}render(){const e=()=>{const e=()=>o.createElement(o.Fragment,null,this.props.loading&&this.props.loading(),!this.props.loading&&o.createElement("div",{className:"flax fx-guard-loader"},"Loading .."));return o.createElement(o.Fragment,null,o.createElement(l,{fallback:o.createElement(o.Fragment,null,this.props.naked&&e(),!this.props.naked&&o.createElement("div",{className:"flax fx-guard-loading"},e()))},o.createElement(P,{releaseBusy:e=>this.releaseBusy(e),refreshId:this.state.refreshId,reloadId:this.state.reloadId,api:this.props.api,render:this.props.render,error:this.props.error,naked:this.props.naked})))};return o.createElement(o.Fragment,null,this.props.naked&&e(),!this.props.naked&&o.createElement("div",{className:u("flax fx-guard",{"--loading":this.state.busy})},e()))}}
//# sourceMappingURL=index.module.js.map
