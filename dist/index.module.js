import e from"query-string";import t from"lru-cache";import r from"axios";import s,{Component as n,Suspense as a,useEffect as o,useState as l}from"react";const i=new t({max:100,maxAge:6e5}),c={},u=(e,t,r,s)=>{if(!t)return void(s?e.reject(s):e.resolve({data:null==r?void 0:r.data,response:r}));c[t].splice(0,c[t].length).forEach((({resolve:e,reject:t})=>{s?t(s):e({data:null==r?void 0:r.data,response:r})}))},p=e=>e?"object"!=typeof e?e:Object.keys(e).reduce(((t,r)=>("object"==typeof e[r]?e[r].current instanceof HTMLElement?t[r]=e[r].current.value:t[r]=p(e[r]):t[r]=e[r],t)),{}):e;function d(t){return new Promise(((s,n)=>{setTimeout((()=>{const a=((t,r)=>{const s=e.stringify(r);return t+(s?(t.includes("?")?"&":"?")+s:"")})(t.url,t.query||{}),o="GET"===t.method&&t.cacheMaxAge&&t.cacheMaxAge>0?"":null,l=o&&i.get(o),d="GET"===t.method&&t.throttle?"".concat(t.method," ").concat(a," ").concat(t.delay||0):null;if(d&&(c[d]=c[d]||[],c[d].push({resolve:s,reject:n}),c[d].length>1))return;if(l)return void s(l);const h=(new Date).getTime();r.request({method:t.method,url:a,headers:t.headers,responseType:t.responseType,data:p("function"==typeof t.data?t.data():t.data)}).then((e=>{const r=(t.delay||0)-((new Date).getTime()-h);setTimeout((()=>{u({resolve:s,reject:n},d,e,null)}),Math.max(0,r))})).catch((e=>{const r=(t.delay||0)-((new Date).getTime()-h);setTimeout((()=>{u({resolve:s,reject:n},d,null,e)}),Math.max(0,r))}))}),25)}))}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}export class FxButton extends n{constructor(e){super(e),this.state={busy:!1}}handleClick(){this.state.busy||(this.setState(f(f({},this.state),{},{busy:!0})),d(f({},this.props.api)).then((e=>{this.props.success&&this.props.success(e.data,e.response),this.props.done&&this.props.done(e.data,null,e.response),this.setState(f(f({},this.state),{},{busy:!1}))})).catch((e=>{this.props.error&&this.props.error(e),this.props.done&&this.props.done(null,e,null),this.setState(f(f({},this.state),{},{busy:!1}))})))}render(){return s.createElement("button",{className:"flax fx-button",onClick:()=>this.handleClick(),disabled:this.state.busy},this.props.children||this.props.label)}}function b(...e){return e.reduce(((e,t)=>("string"==typeof t&&t?e.push(t):Array.isArray(t)?e.push(b(t)):t&&"object"==typeof t&&Object.keys(t).forEach((r=>{t[r]&&e.push(r)})),e)),[]).join(" ")}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e,t){return()=>({status:t?"ERROR":"SUCCESS",result:(null==e?void 0:e.data)||null,error:t})}function E(e){const[t,r]=l(),{api:n,refreshId:a,reloadId:i,error:c,naked:u}=e,p=()=>d(Object.assign({throttle:!1!==n.throttle,refreshId:a},e.api));if(o((()=>{i>0&&p().then((t=>{r((()=>j(t,null))),e.releaseBusy(!0)})).catch((t=>{r((()=>j(null,t))),e.releaseBusy(!1)}))}),[i]),o((()=>{r((()=>function(e,t){let r,s,n="PENDING";return t.then((t=>{({result:s,status:n,error:r}=j(t,null)()),e(!0)})).catch((t=>{({result:s,status:n,error:r}=j(null,t)()),e(!1)})),()=>{if("PENDING"===n)throw t;return{status:n,error:r,result:s}}}(e.releaseBusy,p())))}),[n.method,n.url,a]),!t)return s.createElement(s.Fragment,null);const h=t();if("ERROR"===h.status){const e=()=>{var e,t;return s.createElement(s.Fragment,null,c&&c((null===(e=h.error)||void 0===e||null===(t=e.response)||void 0===t?void 0:t.data)||null,h.error),!c&&s.createElement("div",null,"Error (",h.error.message,")"))};return s.createElement(s.Fragment,null,u&&e(),!u&&s.createElement("div",{className:"flax fx-guard-error"},"r()"))}return s.createElement(s.Fragment,null,e.render(h.result))}export class FxGuard extends n{constructor(e){super(e),this.state={refreshId:0,reloadId:0,busy:!1}}reload(e){this.state.busy||(e?this.setState(g(g({},this.state),{},{reloadId:this.state.reloadId+1,busy:!0})):this.setState(g(g({},this.state),{},{refreshId:this.state.refreshId+1,busy:!0})))}releaseBusy(e){this.props.done&&this.props.done(e),this.setState(g(g({},this.state),{},{busy:!1}))}render(){const e=()=>{const e=()=>s.createElement(s.Fragment,null,this.props.loading&&this.props.loading(),!this.props.loading&&s.createElement("div",{className:"flax fx-guard-loader"},"Loading .."));return s.createElement(s.Fragment,null,s.createElement(a,{fallback:s.createElement(s.Fragment,null,this.props.naked&&e(),!this.props.naked&&s.createElement("div",{className:"flax fx-guard-loading"},e()))},s.createElement(E,{releaseBusy:e=>this.releaseBusy(e),refreshId:this.state.refreshId,reloadId:this.state.reloadId,api:this.props.api,render:this.props.render,error:this.props.error,naked:this.props.naked})))};return s.createElement(s.Fragment,null,this.props.naked&&e(),!this.props.naked&&s.createElement("div",{className:b("flax fx-guard",{"--loading":this.state.busy})},e()))}}
//# sourceMappingURL=index.module.js.map
