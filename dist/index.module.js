import e from"query-string";import t from"p-cancelable";import r from"lru-cache";import s from"axios";import n,{render as a}from"react-dom";import o,{Component as l,useState as c,useEffect as i,Suspense as d}from"react";function u(...e){return e.reduce(((e,t)=>("string"==typeof t&&t?e.push(t):Array.isArray(t)?e.push(u(t)):t&&"object"==typeof t&&Object.keys(t).forEach((r=>{t[r]&&e.push(r)})),e)),[]).join(" ")}function p(e){const{container:t}={container:document.getElementById("fx-notification-container")||(()=>{const e=document.createElement("div");return e.id="fx-notification-container",e.classList.add("flax"),e.classList.add("fx-notification-container"),document.body.appendChild(e),e})()};return{container:t,alert:e=>{const{delay:r,...s}=e,l=document.createElement("div");l.classList.add("fx-notification-wrapper"),t.appendChild(l),a(o.createElement(h,s),l),setTimeout((()=>{l.classList.add("--hide"),setTimeout((()=>{n.unmountComponentAtNode(l),l.remove()}),450)}),r||3e3)}}}function h(e){const{type:t,title:r,message:s}=e;return i((()=>()=>{})),o.createElement(o.Fragment,null,o.createElement("div",{className:u("flax fx-notification",`--${(t||"info").toLocaleLowerCase()}`)},t&&function(e){return e&&"INFO"!==e?o.createElement("div",{className:"--icon"},"SUCC"===e&&o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})),"WARN"===e&&o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})),"ERROR"===e&&o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}))):null}(t),r&&o.createElement("strong",null,r),s))}const m=new r({max:100,maxAge:6e5}),f=(e,t,r,s,n)=>{n?(n.response?.data&&(r.errReducer?n.response.reduced=r.errReducer(n.response?.data,n):n.response.reduced=n.response?.data),t(n)):e({data:s?.data,reduced:r.reducer?r.reducer(s?.data):s?.data,response:s})},y={},g=(e,t,r,s,n,a)=>{if(a&&e.props.cacheMaxAge&&m.set(a,{data:r?.data},e.props.cacheMaxAge),!t){const t=(e.props.delay||0)-((new Date).getTime()-n.getTime());return void setTimeout((()=>{f(e.resolve,e.reject,e.props,r,s)}),Math.max(t,0))}y[t].splice(0,y[t].length).forEach((({resolve:e,reject:t,props:a})=>{const o=(a.delay||0)-((new Date).getTime()-n.getTime());setTimeout((()=>{f(e,t,a,r,s)}),Math.max(o,0))}))},E=e=>e?"object"!=typeof e||Array.isArray(e)?e:Object.keys(e).reduce(((t,r)=>("object"==typeof e[r]&&null!==e[r]?e[r].current instanceof HTMLElement?t[r]=e[r].current.value:t[r]=E(e[r]):"bigint"==typeof e[r]?t[r]=String(e[r]):t[r]=e[r],t)),{}):e;export function setDefaultHeaders(e){s.defaults.headers.common=Object.assign(s.defaults.headers.common,e)}export function setBaseUrl(e){s.defaults.baseURL=e}export function setDefaultTransformResponse(e){s.defaults.transformResponse=e}function x(r){const n=new t(((t,a,o)=>{const l=()=>{n.cancel()},c=s.CancelToken.source(),i=((t,r)=>{const s=e.stringify(r);return t+(s?(t.includes("?")?"&":"?")+s:"")})(r.url,r.query||{}),d="GET"===r.method&&r.throttle?`${r.method} ${i} ${r.delay||0}`:null,u="GET"===r.method&&r.cacheMaxAge&&r.cacheMaxAge>0?`${r.method} ${r.url} ${r.cacheMaxAge}`:null,p=u&&m.get(u);p?g({resolve:t,reject:a,cancelled:!1,props:r},null,p,null,new Date,null):(o.shouldReject=!1,o((()=>{d&&1!==y[d].length||c.cancel()})),setTimeout((()=>{if(d&&(y[d]=y[d]||[],y[d].push({resolve:t,reject:a,cancel:l,props:r}),y[d].length>1))return;const e=new Date;s.request({cancelToken:c.token,method:r.method,url:i,headers:r.headers,responseType:r.responseType,data:E("function"==typeof r.data?r.data():r.data)}).then((s=>{g({resolve:t,reject:a,cancelled:n.isCanceled,props:r},d,s,null,e,u)})).catch((s=>{g({resolve:t,reject:a,cancelled:n.isCanceled,props:r},d,null,s,e,null)}))}),25))}));return n}export const notify=(e,t)=>{if(!e)return;if("string"==typeof e&&(e={message:e}),!e.message)return;e.type=e.type||t;const{alert:r}=p();r(e)};export function useRequest(e,t){const[r,s]=c(0),[n,a]=c({busy:!1,response:void 0,errorResponse:void 0}),{success:o,done:l,error:i}=t||{},d=[];return{reqId:r,request:t=>{if(n.busy)return!1;a({busy:!0,response:void 0,errorResponse:void 0});const c={...e};t?.data&&(c.data=t.data),t?.query&&(c.query=t?.query),t?.headers&&(c.headers=t?.headers);const u=x(c);return u.then((e=>{notify(o&&o(e.reduced,e.response),"SUCC"),notify(l&&l(e.data,null,e.response),"INFO"),s(r+1),a({busy:!1,response:e.reduced,errorResponse:void 0})})).catch((e=>{const t="number"==typeof e.response?.status&&e.response?.status<500?"WARN":"ERROR";notify(i&&i(e.response?.reduced||e,e),t),notify(l&&l(e.response?.data,e,e.response),t),s(r+1),a({busy:!1,response:e.response?.reduced,errorResponse:void 0})})),d.push(u),!0},response:n,cancel:()=>{let e;for(;e=d.pop();)e.cancel()}}}export class FxButton extends l{constructor(e){super(e),this.state={busy:!1}}noti(e,t){notify(e,t)}handleClick(){if(this.state.busy)return;this.setState({...this.state,busy:!0});const{success:e,error:t,done:r}=this.props;x({...this.props.api}).then((t=>{this.noti(e&&e(t.reduced,t.response),"SUCC"),this.noti(r&&r(t.data,null,t.response),"INFO"),this.setState({...this.state,busy:!1})})).catch((e=>{const s="number"==typeof e.response?.status&&e.response?.status<500?"WARN":"ERROR";this.noti(t&&t(e.response?.reduced,e),s),this.noti(r&&r(e.response?.data,e,e.response),s),this.setState({...this.state,busy:!1})}))}render(){const e=`${this.props.tag||"button"}`;return o.createElement(e,{className:`flax fx-button ${this.state.busy?"--busy":""} ${this.props.className||""}`,onClick:()=>this.handleClick(),disabled:this.state.busy},this.props.children||this.props.label)}}function b(e,t){return()=>({status:t?"ERROR":"SUCCESS",result:e,error:t})}function v(e){const[t,r]=c(),{api:s,refreshId:n,reloadId:a,error:l,naked:d}=e,u=()=>x(Object.assign({throttle:!1!==s.throttle,refreshId:n},e.api,{reducer:void 0,errReducer:void 0}));if(i((()=>{let t;return a>0&&(t=u(),t.then((s=>{t?.isCanceled||(r((()=>b(s,null))),e.releaseBusy(!0))})).catch((s=>{t?.isCanceled||(r((()=>b(null,s))),e.releaseBusy(!1))}))),()=>{t&&t.cancel()}}),[a]),i((()=>{let t;return r((()=>(t=u(),function(e,t){let r,s,n="PENDING";return t.then((a=>{t.isCanceled||(({result:s,status:n,error:r}=b(a,null)()),e(!0))})).catch((a=>{t.isCanceled||(({result:s,status:n,error:r}=b(null,a)()),e(!1))})),()=>{if("PENDING"===n)throw t;return{status:n,error:r,result:s}}}(e.releaseBusy,t)))),()=>{t&&t.cancel()}}),[s.method,s.url,n]),!t)return o.createElement(o.Fragment,null);const p=t();if("ERROR"===p.status){const t=()=>p.error?.response?.data?e.api.errReducer?e.api.errReducer(p.error?.response.data,p.error):p.error?.response.data:null,r=()=>o.createElement(o.Fragment,null,l&&l(t(),p.error),!l&&o.createElement("div",null,"Error (",p.error?.message,")"));return o.createElement(o.Fragment,null,d&&r(),!d&&o.createElement("div",{className:"flax fx-guard-error"},r()))}return o.createElement(o.Fragment,null,e.render(p.result?.data?e.api.reducer?e.api.reducer(p.result?.data):p.result?.data:null,e.refreshId>0))}export class FxGuard extends l{constructor(e){super(e),this.state={refreshId:0,reloadId:0,busy:!0,silent:!1,className:void 0}}reload(e,t){this.state.busy||(e?this.setState({...this.state,reloadId:this.state.reloadId+1,busy:!0,silent:!0,className:t}):this.setState({...this.state,refreshId:this.state.refreshId+1,busy:!0,silent:!1,className:void 0}))}releaseBusy(e){this.props.done&&this.props.done(e),this.setState({...this.state,busy:!1,silent:!1,className:void 0})}render(){const e=()=>{const e=()=>o.createElement(o.Fragment,null,this.props.disableLoading&&o.createElement(o.Fragment,null,this.props.render(null,this.state.refreshId>0)),this.props.loading&&this.props.loading(),!this.props.loading&&!this.props.disableLoading&&o.createElement("div",{className:"flax fx-guard-loader"},"Loading .."));return o.createElement(o.Fragment,null,o.createElement(d,{fallback:o.createElement(o.Fragment,null,this.props.naked&&e(),!this.props.naked&&o.createElement("div",{className:"flax fx-guard-loading"},e()))},o.createElement(v,{releaseBusy:e=>this.releaseBusy(e),refreshId:this.state.refreshId,reloadId:this.state.reloadId,api:this.props.api,render:this.props.render,error:this.props.error,naked:this.props.naked})))};return o.createElement(o.Fragment,null,this.props.naked&&e(),!this.props.naked&&o.createElement("div",{className:u("flax fx-guard",{"--loading":this.state.busy,"--silent":this.state.silent,[this.state.className||"--noname"]:!!this.state.className})},e()))}}
//# sourceMappingURL=index.module.js.map
